#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

#define NUM_INT 4096

int main(void) {
  int tube[2];
  if (pipe(tube) == -1) {
    perror("pipe");
    exit(EXIT_FAILURE);
  }

  ssize_t n;
  char message[100];
  switch (fork()) {
  case -1:
    perror("fork");
    exit(EXIT_FAILURE);
  case 0:
    if (close(tube[0]) == -1) {
      perror("close");
      exit(EXIT_FAILURE);
    }
      char message[100]  = "Je vous envoie un message\n";
      if (write(tube[1], message, sizeof(message)) == -1) {
        perror("write");
        exit(EXIT_FAILURE);
    }
    if (close(tube[1]) == -1) {
      perror("close");
      exit(EXIT_FAILURE);
    }
    break;
  default:  
    if (close(tube[1]) == -1) {
      perror("close");
      exit(EXIT_FAILURE);
    }
    while ((n = read(tube[0], message, sizeof(message))) > 0) {
		printf("Lecture d\'un message: %s", message);
    }
    if (n == -1) {
      perror("read");
      exit(EXIT_FAILURE);
    }
    if (close(tube[0]) == -1) {
      perror("close");
      exit(EXIT_FAILURE);
    }
    break;
  }
  exit(EXIT_SUCCESS);
}
